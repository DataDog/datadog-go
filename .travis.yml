language: go

arch:
  - amd64
  - arm64

go:
  - 1.13.x
  - 1.14.x
  - 1.15.x

jobs:
  include:
    # test 32bit build too.
    - arch: amd64
      go: 1.15.x
      script:
        - GOARCH=386 go test -v ./...
    - arch: amd64
      go: 1.14.x
      script:
        - GOARCH=386 go test -v ./...
    - arch: amd64
      go: 1.13.x
      script:
        - GOARCH=386 go test -v ./...
    # testing packages are no longer compatible with 1.12. We only test that we
    # can build.
    - go: 1.12.x
      script:
        - ls -l
        - go build -o test-build ./example/simple_example.go
        - ./test-build

script:
  # race detector is only available on amd64
 - if [[ "$TRAVIS_CPU_ARCH" == "amd64" ]]; then go test -race -v ./...; else go test -v ./...; fi
 - go vet ./...
 - "[ -z \"`go fmt ./...`\" ]"
